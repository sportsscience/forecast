<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPA Calculator & Forecaster</title>
    <style>
        /* --- Global Styles & Turquoise Green Theme --- */
        :root {
            --primary-color: #008080; /* Teal */
            --secondary-color: #40E0D0; /* Turquoise */
            --background-color: #F0FFFF; /* Azure */
            --text-color: #333;
            --light-text-color: #fff;
            --border-color: #B2DFDB; /* Light Teal */
            --shadow-color: rgba(0, 0, 0, 0.1);
            --danger-color: #FF6B6B;
            --warning-color: #FFA500;
            --success-color: #2E8B57;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 850px;
            margin: 20px auto;
            padding: 25px 40px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 5px 20px var(--shadow-color);
            transition: all 0.3s ease-in-out;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        /* --- Forms and Inputs --- */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }

        label small {
            font-weight: 400;
            color: #666;
            display: block;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgba(0, 128, 128, 0.2);
            outline: none;
        }

        /* --- Buttons --- */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--light-text-color);
        }

        .btn-primary:hover {
            background-color: #006666;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 128, 128, 0.3);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--text-color);
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        
        .btn-add {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            padding: 0;
            line-height: 1;
        }

        .forecast-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }

        /* --- Result Displays --- */
        .result-box {
            background-color: var(--background-color);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 5px solid var(--secondary-color);
        }

        .result-box p {
            margin: 8px 0;
            font-size: 18px;
        }
        
        .status-text {
            font-weight: bold;
            font-size: 1em;
            padding: 5px 10px;
            border-radius: 5px;
            color: white;
            display: inline-block;
        }
        .status-normal { background-color: var(--success-color); }
        .status-prob1 { background-color: var(--warning-color); }
        .status-prob2 { background-color: var(--danger-color); }
        .status-dismissed { background-color: #333; }

        /* --- Table for GPA Forecast --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        thead {
            background-color: var(--primary-color);
            color: var(--light-text-color);
        }
        
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        td input, td select {
            padding: 8px;
            font-size: 14px;
        }
        
        input:read-only {
            background-color: #f0f0f0;
            border: 1px solid #e0e0e0;
            cursor: not-allowed;
        }

        /* --- Modal (Popup) Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
            width: 90%;
            max-width: 450px;
        }

        .modal-content p {
            font-size: 20px;
            margin-bottom: 30px;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        /* --- Page & Print Styles --- */
        .page { display: block; }
        .page.hidden { display: none; }
        
        @media print {
            body { padding: 0; background-color: #fff; }
            .container { box-shadow: none; border: 1px solid #ccc; margin: 0; max-width: 100%; border-radius: 0; }
            .no-print { display: none !important; }
            h1, h2, h3 { color: #000; border-color: #000; }
            .result-box { border-left-color: #000; background-color: #f9f9f9; }
            input, select { border: none; background: transparent; padding: 0; -webkit-appearance: none; appearance: none; }
            .status-text { color: black !important; background-color: #eee !important; padding: 2px 4px; border: 1px solid #999; }
            table { font-size: 12pt; }
            td, th { padding: 8px; }
            tbody tr:nth-child(even) { background-color: #fff; }
        }
    </style>
</head>
<body>

    <div class="container" id="app-container">
        
        <!-- ====================== PAGE 1: INITIAL INFO ====================== -->
        <div id="initial-page" class="page">
            <h1>GPA Calculator</h1>
            <form id="initial-form">
                <h2>Personal Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="studentId">Student ID Number</label>
                        <input type="text" id="studentId" required>
                    </div>
                    <div class="form-group">
                        <label for="yearLevel">Year Level</label>
                        <input type="text" id="yearLevel" required>
                    </div>
                </div>

                <h2>Current GPA Calculation</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="accumulatedCredits">Accumulated Credits
                            <small>Total number of credits you have completed.</small>
                        </label>
                        <input type="number" id="accumulatedCredits" step="1" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="latestGpa">Latest Cumulative GPA</label>
                        <input type="number" id="latestGpa" step="0.01" min="0" max="4.00" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary no-print">Calculate Status</button>
            </form>
            <div id="initial-result-display" style="display: none;"></div>
        </div>

        <!-- ====================== PAGE 2: GPA FORECAST ====================== -->
        <div id="forecast-page" class="page hidden">
            <h2>Future Term GPA Forecast</h2>
            <p>Enter the subjects for the upcoming term. Click '+' to add more subjects.</p>
            <form id="forecast-form">
                <table>
                    <thead>
                        <tr>
                            <th>Subject Code</th>
                            <th>Subject Name</th>
                            <th>Credit</th>
                            <th>Grade</th>
                            <th>Grade Point</th>
                            <th>Total Score</th>
                        </tr>
                    </thead>
                    <tbody id="forecast-table-body">
                        <!-- Rows are added here by JavaScript -->
                    </tbody>
                </table>
                 <div class="forecast-controls no-print">
                    <button type="button" id="add-row-btn" class="btn btn-add">+</button>
                    <button type="button" id="calculate-btn" class="btn btn-primary">Calculate Future GPA</button>
                </div>
            </form>
        </div>
        
        <!-- ====================== PAGE 3: FINAL REPORT ====================== -->
        <div id="report-page" class="page hidden">
            <!-- Content injected by JavaScript -->
        </div>

    </div>

    <!-- ========================= MODAL (POPUP) ========================= -->
    <div id="modal" class="modal-overlay no-print">
        <div class="modal-content">
            <p id="modal-text"></p>
            <div id="modal-buttons" class="modal-buttons">
                <!-- Buttons are added here by JavaScript -->
            </div>
        </div>
    </div>


    <script>
        // --- DOM Element References ---
        const initialPage = document.getElementById('initial-page');
        const forecastPage = document.getElementById('forecast-page');
        const reportPage = document.getElementById('report-page');
        
        const initialForm = document.getElementById('initial-form');
        const forecastTableBody = document.getElementById('forecast-table-body');
        
        const initialResultDisplay = document.getElementById('initial-result-display');
        
        const addRowBtn = document.getElementById('add-row-btn');
        const calculateBtn = document.getElementById('calculate-btn');
        
        const modal = document.getElementById('modal');
        const modalText = document.getElementById('modal-text');
        const modalButtons = document.getElementById('modal-buttons');

        // --- Grade to Point Mapping ---
        const gradeMap = { 'A': 4.0, 'B+': 3.5, 'B': 3.0, 'C+': 2.5, 'C': 2.0, 'D+': 1.5, 'D': 1.0, 'F': 0.0 };

        // --- Global State to store data between pages ---
        let studentData = {};

        // --- Helper Functions ---

        /**
         * Determines student status based on GPA.
         * @param {number} gpa - The Cumulative GPA.
         * @returns {{text: string, class: string}} The student status object.
         */
        function getStudentStatus(gpa) {
            if (gpa >= 2.00) return { text: 'Normal', class: 'status-normal' };
            if (gpa >= 1.75) return { text: 'Probation Level 1 (GPAX 1.75–1.99)', class: 'status-prob1' };
            if (gpa >= 1.50) return { text: 'Probation Level 2 (GPAX 1.50–1.74)', class: 'status-prob2' };
            return { text: 'Dismissal Risk (GPAX < 1.50)', class: 'status-dismissed' };
        }

        /**
         * Displays a modal with custom text and buttons.
         * @param {string} text - The message to show in the modal.
         * @param {Array<Object>} buttons - Array of button objects {text, class, onClick}.
         */
        function showModal(text, buttons) {
            modalText.textContent = text;
            modalButtons.innerHTML = ''; // Clear previous buttons
            buttons.forEach(btnInfo => {
                const button = document.createElement('button');
                button.textContent = btnInfo.text;
                button.className = `btn ${btnInfo.class}`;
                button.onclick = () => {
                    hideModal();
                    btnInfo.onClick();
                };
                modalButtons.appendChild(button);
            });
            modal.style.display = 'flex';
        }

        /** Hides the modal. */
        function hideModal() {
            modal.style.display = 'none';
        }

        // --- Event Listener for Initial Form Submission ---
        initialForm.addEventListener('submit', function(event) {
            event.preventDefault();

            const credits = parseFloat(document.getElementById('accumulatedCredits').value);
            const gpa = parseFloat(document.getElementById('latestGpa').value);
            const score = credits * gpa;
            const status = getStudentStatus(gpa);

            studentData = {
                fullName: document.getElementById('fullName').value,
                studentId: document.getElementById('studentId').value,
                yearLevel: document.getElementById('yearLevel').value,
                previousCredits: credits,
                previousGpa: gpa,
                previousScore: score
            };

            initialResultDisplay.innerHTML = `
                <div class="result-box">
                    <p><strong>GPA Score (Total Points):</strong> ${score.toFixed(2)}</p>
                    <p><strong>Current Status:</strong> <span class="status-text ${status.class}">${status.text}</span></p>
                </div>
            `;
            initialResultDisplay.style.display = 'block';

            setTimeout(() => {
                showModal('Would you like to forecast your future GPA?', [
                    { text: 'Yes', class: 'btn-primary', onClick: switchToForecastPage },
                    { text: 'No', class: 'btn-secondary', onClick: () => {} }
                ]);
            }, 500);
        });
        
        /**
         * Transitions the view to the forecast page and adds the first row.
         */
        function switchToForecastPage() {
            initialPage.classList.add('hidden');
            forecastPage.classList.remove('hidden');
            addNewForecastRow(); // Add the first row automatically
        }
        
        /**
         * Adds a new, empty row to the forecast table.
         */
        function addNewForecastRow() {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="subject-code" placeholder="e.g., CS101"></td>
                <td><input type="text" class="subject-name" placeholder="e.g., Intro to Programming"></td>
                <td><input type="number" class="credit" min="0" step="1"></td>
                <td>
                    <select class="grade">
                        <option value="">--</option>
                        ${Object.keys(gradeMap).map(grade => `<option value="${grade}">${grade}</option>`).join('')}
                    </select>
                </td>
                <td><input type="text" class="grade-point" readonly></td>
                <td><input type="text" class="total-score" readonly></td>
            `;
            forecastTableBody.appendChild(row);

            row.querySelector('.credit').addEventListener('input', () => updateRowCalculation(row));
            row.querySelector('.grade').addEventListener('change', () => updateRowCalculation(row));
        }
        
        /**
         * Updates the auto-calculated fields for a specific table row.
         * @param {HTMLElement} row - The <tr> element to update.
         */
        function updateRowCalculation(row) {
            const credit = parseFloat(row.querySelector('.credit').value) || 0;
            const grade = row.querySelector('.grade').value;
            const gradePointInput = row.querySelector('.grade-point');
            const totalScoreInput = row.querySelector('.total-score');

            if (grade && gradeMap.hasOwnProperty(grade)) {
                const gradePoint = gradeMap[grade];
                gradePointInput.value = gradePoint.toFixed(2);
                totalScoreInput.value = (credit * gradePoint).toFixed(2);
            } else {
                gradePointInput.value = '';
                totalScoreInput.value = '';
            }
        }
        
        // Event listeners for forecast page buttons
        addRowBtn.addEventListener('click', addNewForecastRow);
        calculateBtn.addEventListener('click', calculateFinalReport);

        /**
         * Calculates all final results and generates the summary report page.
         */
        function calculateFinalReport() {
            let termCredits = 0;
            let termScoreSum = 0;
            const forecastRows = forecastTableBody.querySelectorAll('tr');

            let forecastTableHTML = '<table><thead><tr><th>Subject Code</th><th>Subject Name</th><th>Credit</th><th>Grade</th><th>Grade Point</th><th>Score</th></tr></thead><tbody>';
            forecastRows.forEach(row => {
                const credit = parseFloat(row.querySelector('.credit').value) || 0;
                const score = parseFloat(row.querySelector('.total-score').value) || 0;
                
                if (credit > 0) {
                    termCredits += credit;
                    termScoreSum += score;
                }
                
                forecastTableHTML += `<tr>
                    <td>${row.querySelector('.subject-code').value || '-'}</td>
                    <td>${row.querySelector('.subject-name').value || '-'}</td>
                    <td>${credit || '-'}</td>
                    <td>${row.querySelector('.grade').value || '-'}</td>
                    <td>${row.querySelector('.grade-point').value || '-'}</td>
                    <td>${row.querySelector('.total-score').value || '-'}</td>
                </tr>`;
            });
            forecastTableHTML += '</tbody></table>';

            const termGpa = (termCredits > 0) ? (termScoreSum / termCredits) : 0;
            const newTotalCredits = studentData.previousCredits + termCredits;
            const newTotalScore = studentData.previousScore + termScoreSum;
            const newGpax = (newTotalCredits > 0) ? (newTotalScore / newTotalCredits) : 0;
            const newStatus = getStudentStatus(newGpax);

            reportPage.innerHTML = `
                <h1>GPA Summary Report</h1>
                
                <h3>Personal Information</h3>
                <div class="result-box">
                    <p><strong>Full Name:</strong> ${studentData.fullName}</p>
                    <p><strong>Student ID:</strong> ${studentData.studentId}</p>
                    <p><strong>Year Level:</strong> ${studentData.yearLevel}</p>
                </div>

                <h3>Previous Academic Status</h3>
                <div class="result-box">
                    <p><strong>Previous Accumulated Credits:</strong> ${studentData.previousCredits}</p>
                    <p><strong>Previous GPA:</strong> ${studentData.previousGpa.toFixed(2)}</p>
                </div>
                
                <h3>Future Term Forecast Details</h3>
                ${forecastTableHTML}
                
                <h3>Final Projected Results</h3>
                <div class="result-box">
                    <p><strong>Term GPA:</strong> ${termGpa.toFixed(2)}</p>
                    <p><strong>Credits This Term:</strong> ${termCredits}</p>
                    <p><strong>New Cumulative GPA (GPAX):</strong> <span style="font-size: 1.2em; font-weight: bold; color: var(--primary-color);">${newGpax.toFixed(2)}</span></p>
                    <p><strong>New Student Status:</strong> <span class="status-text ${newStatus.class}">${newStatus.text}</span></p>
                </div>

                <br>
                <button onclick="window.print()" class="btn btn-primary no-print" style="width: 100%;">Print Full Report</button>
            `;
            
            forecastPage.classList.add('hidden');
            reportPage.classList.remove('hidden');
        }
    </script>
</body>
</html>
